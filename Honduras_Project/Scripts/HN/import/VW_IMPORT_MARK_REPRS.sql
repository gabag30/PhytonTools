--FIELDS FILE_SEQ, FILE_TYPE, FILE_SERIES, FILE_NBR,AGENT_CODE,REPRESENTATIVE_TYPE,PERSON_NAME,NATIONALITY_COUNTRY_CODE,IND_COMPANY,RESIDENCE_COUNTRY_CODE,ADDRESS_STREET;;
--QUERY 

select mm.FILE_SEQ,mm.FILE_TYPE,mm.FILE_SERIES,mm.FILE_NBR,AGENT_CODE,REPRESENTATIVE_TYPE,PERSON_NAME,NATIONALITY_COUNTRY_CODE,IND_COMPANY,RESIDENCE_COUNTRY_CODE,case when ADDRESS_STREET is null then 'falta capturar dirección agente: '+cast(AGENT_CODE as varchar) else ADDRESS_STREET end address_street from (select om.FILE_SEQ,om.FILE_TYPE,om.FILE_SERIES,om.FILE_NBR,cast(replace(ll.agente,' ','') as integer) AGENT_CODE,'AG' REPRESENTATIVE_TYPE,replace(replace(nombre,'   ',''),'  ','') PERSON_NAME,'HN' NATIONALITY_COUNTRY_CODE,0 IND_COMPANY,'HN' RESIDENCE_COUNTRY_CODE,direccion ADDRESS_STREET from (select  agente, nombre,direccion,pais ,RN = ROW_NUMBER()OVER(PARTITION BY agente ORDER BY agente)from (SELECT   agente     , nombre      ,Case when (direccion='') then 'DIRECCION A CAPTURAR' else direccion end direccion,'HN' as pais FROM dbo.vw_origin_agentes) ff where agente!=0  ) ll inner join vw_origin_marca mm on ll.agente=mm.agente inner join vw_marcas2 om on mm.nro_solici=om.nro_solici where ll.RN=1)mm inner join vw_import_mark aa on mm.file_seq=aa.file_seq and mm.file_type=aa.file_type and mm.file_series=aa.file_series and mm.file_nbr=aa.file_nbr ;;