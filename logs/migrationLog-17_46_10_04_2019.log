2019-04-10 17:46:45,824 - root - WARNING - connected to Sqlserver.
2019-04-10 17:46:45,835 - root - WARNING - Updating original tables with correction script.
2019-04-10 17:51:34,681 - root - INFO - <_io.TextIOWrapper name='<stderr>' mode='w' encoding='UTF-8'>Child returned, 0
2019-04-10 17:51:34,681 - root - WARNING - Updating orignal tables with additional correction.
2019-04-10 17:51:44,712 - root - WARNING - Regenerating intermediate tables.
2019-04-10 17:51:44,907 - root - WARNING - creating views.
2019-04-10 17:51:44,908 - root - INFO - wrong query:create view dbo.vw_prio as select aaa.FILE_SEQ,aaa.FILE_TYPE,aaa.FILE_SERIES,aaa.FILE_NBR,country_code,application_id,priority_date,ind_accepted   from (select cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar) FILE_SEQ, 'M' FILE_TYPE,   cast(left(nro_solici,4)  as numeric (4,0)) FILE_SERIES,    cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0)) FILE_NBR,pais  country_code,numero application_id,case when fecha is null or fecha ='' then convert(datetime,'1900-01-01',120) when isdate(fecha)=1 then  convert(datetime,fecha,120) when substring(fecha,3,2)<25 then convert(datetime,'20'+substring(fecha,3,8),120) else convert(datetime,'19'+substring(fecha,3,8),120) end  priority_date,case when deleted='N' then 1 else 0 end ind_accepted  FROM HN1.dbo.vw_origin_PRIORIDA where nro_solici is not null and nro_solici!='' and len(replace(nro_solici,' ',''))>6 and isnumeric(left(nro_solici,1))=1 and len(NRO_SOLICI)>6 ) aaa running statementcreate view dbo.vw_prio as select aaa.FILE_SEQ,aaa.FILE_TYPE,aaa.FILE_SERIES,aaa.FILE_NBR,country_code,application_id,priority_date,ind_accepted   from (select cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar) FILE_SEQ, 'M' FILE_TYPE,   cast(left(nro_solici,4)  as numeric (4,0)) FILE_SERIES,    cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0)) FILE_NBR,pais  country_code,numero application_id,case when fecha is null or fecha ='' then convert(datetime,'1900-01-01',120) when isdate(fecha)=1 then  convert(datetime,fecha,120) when substring(fecha,3,2)<25 then convert(datetime,'20'+substring(fecha,3,8),120) else convert(datetime,'19'+substring(fecha,3,8),120) end  priority_date,case when deleted='N' then 1 else 0 end ind_accepted  FROM HN1.dbo.vw_origin_PRIORIDA where nro_solici is not null and nro_solici!='' and len(replace(nro_solici,' ',''))>6 and isnumeric(left(nro_solici,1))=1 and len(NRO_SOLICI)>6 ) aaa 
2019-04-10 17:51:44,908 - root - ERROR - >>>>>>>>>>>>>>> issue with insert query ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Argument data type date is invalid for argument 1 of isdate function. (8116) (SQLExecDirectW)')
2019-04-10 17:51:44,913 - root - INFO - wrong query:CREATE VIEW dbo.vw_marcas2 AS  with cte as (SELECT cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar) file_SEQ ,'M' FILE_TYPE,cast(left(NRO_SOLICI,4) as numeric(4,0)) as FILE_SERIES,cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0)) file_NBR,cast(0 as numeric) ind_import, 'M' application_type, TIPO_MARCA application_subtype, cast(1 as numeric) law_code,CONVERT(datetime,  CASE   WHEN (SOLICITADA IS NULL or SOLICITADA='') THEN '1900-01-01'    when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))         when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))   ELSE SOLICITADA END  ,120) 		FILING_DATE,CONVERT(datetime,  CASE   WHEN (SOLICITADA IS NULL or SOLICITADA='') THEN '1900-01-01' when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))  when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada)) ELSE SOLICITADA END  ,120) RECEPTION_DATE,CONVERT(datetime,  case when isnumeric(substring(PUBLICADA,1,4))=1 then 	case when substring(PUBLICADA,1,4)<1900 and len(PUBLICADA)>0 then '20' + substring(PUBLICADA,3,len(PUBLICADA)) else PUBLICADA end   	else	case when substring(PUBLICADA,1,3)<200 and len(PUBLICADA)>0 then '19' + substring(PUBLICADA,2,len(PUBLICADA)) else PUBLICADA end	end ,120)  PUBLICATION_DATE,  cast(case when (registro is null or registro='') then null else 1 end as numeric(1,0)) ind_registered,   cast(case when (ISNUMERIC(REGISTRO)=0) then right(REGISTRO,1) else '1' end as varchar) registration_type ,        cast(case when registro is null then null else (case when (registrada is null) then 1 else 	   substring(registrada,1,4) end)  end as numeric(4,0))  registration_series,    case    when registro='' then null   when isnumeric(registro)=1 then registro else    LEFT(SUBSTRING(REGISTRO, PATINDEX('%[0-9.-]%', REGISTRO), 8000),           PATINDEX('%[^0-9.-]%', SUBSTRING(REGISTRO, PATINDEX('%[0-9.-]%', REGISTRO), 8000) + 'X') -1) end				   registration_nbr,     CONVERT(datetime,  case   when (registro is null or registro ='') then null   when (registro IS NOT NULL AND REGISTRADA IS NULL AND SOLICITADA IS NULL) THEN '1900-01-01'         when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND SOLICITADA IS NOT NULL)   		THEN (  			CASE   				WHEN (SOLICITADA IS NULL or solicitada='') THEN '1900-01-01'   				when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))     				when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          				ELSE SOLICITADA END)         		ELSE (  			CASE   				WHEN (REGISTRADA IS NULL or registrada='') THEN '1900-01-01'   				when substring(REGISTRADA,1,4)<1900 then '19' + substring(REGISTRADA,3,len(REGISTRADA))  				when substring(REGISTRADA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(REGISTRADA,5,len(REGISTRADA))  				ELSE REGISTRADA END)   		END,120) REGISTRAtion_date,      CONVERT(datetime,  case    	when (registro is null or registro='') then null  	when (registro is not null and (renueva is null or renueva='')) then   		(case   		when (registro is null or registro='') then null   		when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND (SOLICITADA IS NULL or solicitada='')) THEN '1900-01-01'         		when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND SOLICITADA IS NOT NULL) THEN   			(CASE WHEN (SOLICITADA IS NULL or solicitada='') THEN '1900-01-01'   					when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))         					when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          				ELSE SOLICITADA END)         		ELSE (CASE   				WHEN (REGISTRADA IS NULL or registrada='') THEN '1900-01-01'   				when substring(REGISTRADA,1,4)<1900 then '19' + substring(REGISTRADA,3,len(REGISTRADA))         				when substring(REGISTRADA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(REGISTRADA,5,len(REGISTRADA))          				ELSE REGISTRADA END) END)       		when substring(renueva,1,4)<1900 then '20' + substring(renueva,3,len(renueva)) else renueva end,120) entitlement_date ,         case  when (registro is null or registro='') then null   	else convert(datetime,  		case when (registro is not null AND (EXPIRA IS NULL or expira='') AND (SOLICITADA IS NULL or solicitada='') AND (RENUEVA IS NULL or renueva='')) THEN '1900-01-01'   		when (registro is not null AND (EXPIRA IS NULL or expira ='') AND RENUEVA IS NOT NULL and len(renueva)>3) THEN   			(CASE 	    when substring(RENUEVA,1,4)<1900 then '20' + substring(RENUEVA,3,len(RENUEVA))         						when substring(RENUEVA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(RENUEVA,5,len(RENUEVA))          						ELSE RENUEVA END)         		when (registro is not null AND (EXPIRA IS NULL or expira ='') AND (RENUEVA IS  NULL or renueva='') AND SOLICITADA IS NOT NULL) THEN   			(CASE when substring(solicitada,1,2)<19 then '19' + substring(solicitada,3,len(solicitada))   					when substring(solicitada,1,4)<1900 then '20' + substring(solicitada,3,len(solicitada))         					when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          			ELSE SOLICITADA END)         		ELSE  (CASE WHEN (EXPIRA IS NULL or expira='') THEN '1900-01-01'   					when (substring(EXPIRA,1,4)<1900 and substring(EXPIRA,3,2)<60) then '20' + substring(EXPIRA,3,len(EXPIRA))   					when (substring(EXPIRA,1,4)<1900 and substring(EXPIRA,3,2)>60) then '19' + substring(EXPIRA,3,len(EXPIRA))    					when substring(EXPIRA,1,4)>2060  then '19' + substring(EXPIRA,3,len(EXPIRA))   					ELSE EXPIRA END)   		 END,120) 	   end expiration_date ,	  SIGNO sign_type,   NOM_MARCA mark_name,    cast(LIMITACION as varchar(2000)) disclaimer ,      (case when (len(rtomo)>0) then 'Tomo: ' + cast(rtomo as varchar) + ' -- ' else '' end ) +       (case when len(rfolio)>0 then 'Folio: ' + cast(rfolio as varchar) + ' -- ' else '' end) +          (case when len(NRO_RESOL)>0 then 'Resolucion: ' + cast(NRO_RESOL as varchar) + ' -- ' else '' end) +          (case when (len(reserva)>0) then 'Reserva: ' + cast(RESERVA as varchar(max)) else '' end)        notes,     4 as capture_user_id,      getdate() as capture_date, rowNum,NRO_SOLICI ,   RN = ROW_NUMBER()OVER(PARTITION BY cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar),   cast(left(NRO_SOLICI,4) as numeric(4,0)) ,   cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0))    ORDER BY nro_solici)  	   FROM dbo.vw_origin_marca    where Deleted='N' and len(nro_solici)>5       )   select case when rn>1 then file_SEQ + cast(rn as varchar) else file_seq end file_SEQ      ,FILE_TYPE      ,FILE_SERIES      ,file_NBR      ,ind_import      ,application_type      ,application_subtype      ,law_code      ,FILING_DATE      ,RECEPTION_DATE      ,PUBLICATION_DATE      ,ind_registered      ,registration_type      ,registration_series      ,registration_nbr      ,REGISTRAtion_date      ,entitlement_date      ,expiration_date      ,sign_type      ,mark_name      ,disclaimer      ,notes      ,capture_user_id      ,capture_date      ,rowNum      ,NRO_SOLICI      ,RN from cte running statementCREATE VIEW dbo.vw_marcas2 AS  with cte as (SELECT cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar) file_SEQ ,'M' FILE_TYPE,cast(left(NRO_SOLICI,4) as numeric(4,0)) as FILE_SERIES,cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0)) file_NBR,cast(0 as numeric) ind_import, 'M' application_type, TIPO_MARCA application_subtype, cast(1 as numeric) law_code,CONVERT(datetime,  CASE   WHEN (SOLICITADA IS NULL or SOLICITADA='') THEN '1900-01-01'    when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))         when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))   ELSE SOLICITADA END  ,120) 		FILING_DATE,CONVERT(datetime,  CASE   WHEN (SOLICITADA IS NULL or SOLICITADA='') THEN '1900-01-01' when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))  when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada)) ELSE SOLICITADA END  ,120) RECEPTION_DATE,CONVERT(datetime,  case when isnumeric(substring(PUBLICADA,1,4))=1 then 	case when substring(PUBLICADA,1,4)<1900 and len(PUBLICADA)>0 then '20' + substring(PUBLICADA,3,len(PUBLICADA)) else PUBLICADA end   	else	case when substring(PUBLICADA,1,3)<200 and len(PUBLICADA)>0 then '19' + substring(PUBLICADA,2,len(PUBLICADA)) else PUBLICADA end	end ,120)  PUBLICATION_DATE,  cast(case when (registro is null or registro='') then null else 1 end as numeric(1,0)) ind_registered,   cast(case when (ISNUMERIC(REGISTRO)=0) then right(REGISTRO,1) else '1' end as varchar) registration_type ,        cast(case when registro is null then null else (case when (registrada is null) then 1 else 	   substring(registrada,1,4) end)  end as numeric(4,0))  registration_series,    case    when registro='' then null   when isnumeric(registro)=1 then registro else    LEFT(SUBSTRING(REGISTRO, PATINDEX('%[0-9.-]%', REGISTRO), 8000),           PATINDEX('%[^0-9.-]%', SUBSTRING(REGISTRO, PATINDEX('%[0-9.-]%', REGISTRO), 8000) + 'X') -1) end				   registration_nbr,     CONVERT(datetime,  case   when (registro is null or registro ='') then null   when (registro IS NOT NULL AND REGISTRADA IS NULL AND SOLICITADA IS NULL) THEN '1900-01-01'         when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND SOLICITADA IS NOT NULL)   		THEN (  			CASE   				WHEN (SOLICITADA IS NULL or solicitada='') THEN '1900-01-01'   				when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))     				when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          				ELSE SOLICITADA END)         		ELSE (  			CASE   				WHEN (REGISTRADA IS NULL or registrada='') THEN '1900-01-01'   				when substring(REGISTRADA,1,4)<1900 then '19' + substring(REGISTRADA,3,len(REGISTRADA))  				when substring(REGISTRADA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(REGISTRADA,5,len(REGISTRADA))  				ELSE REGISTRADA END)   		END,120) REGISTRAtion_date,      CONVERT(datetime,  case    	when (registro is null or registro='') then null  	when (registro is not null and (renueva is null or renueva='')) then   		(case   		when (registro is null or registro='') then null   		when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND (SOLICITADA IS NULL or solicitada='')) THEN '1900-01-01'         		when (registro is not null AND (REGISTRADA IS NULL or registrada='') AND SOLICITADA IS NOT NULL) THEN   			(CASE WHEN (SOLICITADA IS NULL or solicitada='') THEN '1900-01-01'   					when substring(solicitada,1,4)<1900 then '19' + substring(solicitada,3,len(solicitada))         					when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          				ELSE SOLICITADA END)         		ELSE (CASE   				WHEN (REGISTRADA IS NULL or registrada='') THEN '1900-01-01'   				when substring(REGISTRADA,1,4)<1900 then '19' + substring(REGISTRADA,3,len(REGISTRADA))         				when substring(REGISTRADA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(REGISTRADA,5,len(REGISTRADA))          				ELSE REGISTRADA END) END)       		when substring(renueva,1,4)<1900 then '20' + substring(renueva,3,len(renueva)) else renueva end,120) entitlement_date ,         case  when (registro is null or registro='') then null   	else convert(datetime,  		case when (registro is not null AND (EXPIRA IS NULL or expira='') AND (SOLICITADA IS NULL or solicitada='') AND (RENUEVA IS NULL or renueva='')) THEN '1900-01-01'   		when (registro is not null AND (EXPIRA IS NULL or expira ='') AND RENUEVA IS NOT NULL and len(renueva)>3) THEN   			(CASE 	    when substring(RENUEVA,1,4)<1900 then '20' + substring(RENUEVA,3,len(RENUEVA))         						when substring(RENUEVA,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(RENUEVA,5,len(RENUEVA))          						ELSE RENUEVA END)         		when (registro is not null AND (EXPIRA IS NULL or expira ='') AND (RENUEVA IS  NULL or renueva='') AND SOLICITADA IS NOT NULL) THEN   			(CASE when substring(solicitada,1,2)<19 then '19' + substring(solicitada,3,len(solicitada))   					when substring(solicitada,1,4)<1900 then '20' + substring(solicitada,3,len(solicitada))         					when substring(solicitada,1,4)>2019 then cast(left(NRO_SOLICI,4) as varchar) + substring(solicitada,5,len(solicitada))          			ELSE SOLICITADA END)         		ELSE  (CASE WHEN (EXPIRA IS NULL or expira='') THEN '1900-01-01'   					when (substring(EXPIRA,1,4)<1900 and substring(EXPIRA,3,2)<60) then '20' + substring(EXPIRA,3,len(EXPIRA))   					when (substring(EXPIRA,1,4)<1900 and substring(EXPIRA,3,2)>60) then '19' + substring(EXPIRA,3,len(EXPIRA))    					when substring(EXPIRA,1,4)>2060  then '19' + substring(EXPIRA,3,len(EXPIRA))   					ELSE EXPIRA END)   		 END,120) 	   end expiration_date ,	  SIGNO sign_type,   NOM_MARCA mark_name,    cast(LIMITACION as varchar(2000)) disclaimer ,      (case when (len(rtomo)>0) then 'Tomo: ' + cast(rtomo as varchar) + ' -- ' else '' end ) +       (case when len(rfolio)>0 then 'Folio: ' + cast(rfolio as varchar) + ' -- ' else '' end) +          (case when len(NRO_RESOL)>0 then 'Resolucion: ' + cast(NRO_RESOL as varchar) + ' -- ' else '' end) +          (case when (len(reserva)>0) then 'Reserva: ' + cast(RESERVA as varchar(max)) else '' end)        notes,     4 as capture_user_id,      getdate() as capture_date, rowNum,NRO_SOLICI ,   RN = ROW_NUMBER()OVER(PARTITION BY cast(case when ISNUMERIC(nro_solici)= 0 then right(NRO_SOLICI,1) else '1'  end as varchar),   cast(left(NRO_SOLICI,4) as numeric(4,0)) ,   cast(substring(NRO_SOLICI,5,len(NRO_SOLICI)-(case when ISNUMERIC(nro_solici)=0 then 5 else 4 end)  ) as numeric(10,0))    ORDER BY nro_solici)  	   FROM dbo.vw_origin_marca    where Deleted='N' and len(nro_solici)>5       )   select case when rn>1 then file_SEQ + cast(rn as varchar) else file_seq end file_SEQ      ,FILE_TYPE      ,FILE_SERIES      ,file_NBR      ,ind_import      ,application_type      ,application_subtype      ,law_code      ,FILING_DATE      ,RECEPTION_DATE      ,PUBLICATION_DATE      ,ind_registered      ,registration_type      ,registration_series      ,registration_nbr      ,REGISTRAtion_date      ,entitlement_date      ,expiration_date      ,sign_type      ,mark_name      ,disclaimer      ,notes      ,capture_user_id      ,capture_date      ,rowNum      ,NRO_SOLICI      ,RN from cte 
2019-04-10 17:51:44,913 - root - ERROR - >>>>>>>>>>>>>>> issue with insert query ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Argument data type date is invalid for argument 1 of substring function. (8116) (SQLExecDirectW)')
2019-04-10 17:51:44,921 - root - INFO - wrong query:          create view dbo.vw_userdoc as with cte as (SELECT pet. rowNum       , cast(doc_ser as numeric)  doc_ser    , doc_seq       , cast(doc_nbr as numeric)  doc_nbr         ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , NOMBRE PERSON_NAME ,case when (pais is null or pais='') then 'HN' else  PAIS end NATIONALITY_COUNTRY_CODE ,case when(len( LUGAR)>2 and len(pais)=2 ) then pais when len(lugar)=2 then lugar else 'HN' end RESIDENCE_COUNTRY_CODE ,case when (direccion is null or direccion='') then 'Falta direccion' else  DIRECCION end ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , CALIDAD       , qUien       , CUAL       , NRO_RESOL       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,   HN1.dbo.vw_origin_nuenoms nom ,  HN1.dbo.vw_origin_TITULAR titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and pet.num_serie=nom.NUM_SERIE and nom.titular=titu.TITULAR)    select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq       ,doc_ser USERDOC_SERIES       ,doc_nbr USERDOC_NBR       , IND_IMPORT       , USERDOC_TYPE       , LAW_CODE       , FILING_DATE       , RECEPTION_DATE       , NOTES       , PERSON_NAME         , NATIONALITY_COUNTRY_CODE       , RESIDENCE_COUNTRY_CODE       , ADDRESS_STREET       , CAPTURE_USER_ID       , CAPTURE_DATE from cte running statement          create view dbo.vw_userdoc as with cte as (SELECT pet. rowNum       , cast(doc_ser as numeric)  doc_ser    , doc_seq       , cast(doc_nbr as numeric)  doc_nbr         ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , NOMBRE PERSON_NAME ,case when (pais is null or pais='') then 'HN' else  PAIS end NATIONALITY_COUNTRY_CODE ,case when(len( LUGAR)>2 and len(pais)=2 ) then pais when len(lugar)=2 then lugar else 'HN' end RESIDENCE_COUNTRY_CODE ,case when (direccion is null or direccion='') then 'Falta direccion' else  DIRECCION end ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , CALIDAD       , qUien       , CUAL       , NRO_RESOL       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,   HN1.dbo.vw_origin_nuenoms nom ,  HN1.dbo.vw_origin_TITULAR titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and pet.num_serie=nom.NUM_SERIE and nom.titular=titu.TITULAR)    select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq       ,doc_ser USERDOC_SERIES       ,doc_nbr USERDOC_NBR       , IND_IMPORT       , USERDOC_TYPE       , LAW_CODE       , FILING_DATE       , RECEPTION_DATE       , NOTES       , PERSON_NAME         , NATIONALITY_COUNTRY_CODE       , RESIDENCE_COUNTRY_CODE       , ADDRESS_STREET       , CAPTURE_USER_ID       , CAPTURE_DATE from cte 
2019-04-10 17:51:44,921 - root - ERROR - >>>>>>>>>>>>>>> issue with insert query ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Argument data type date is invalid for argument 1 of isdate function. (8116) (SQLExecDirectW)')
2019-04-10 17:51:44,926 - root - INFO - wrong query:create view dbo.vw_userdoc_owners as with cte as (SELECT pet.rowNum,cast(doc_ser as numeric)  doc_ser, doc_seq       , cast(doc_nbr as numeric)  doc_nbr     ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,'1' ind_service,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , NOMBRE PERSON_NAME ,case when (pais is null or pais='') then 'HN' else  PAIS end NATIONALITY_COUNTRY_CODE ,case when(len( LUGAR)>2 and len(pais)=2 ) then pais when len(lugar)=2 then lugar else 'HN' end RESIDENCE_COUNTRY_CODE ,case when (direccion is null or direccion='') then 'Falta direccion' else  DIRECCION end ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , CALIDAD       , qUien       , CUAL       , NRO_RESOL       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,   HN1.dbo.vw_origin_nuenoms nom ,  HN1.dbo.vw_origin_TITULAR titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and pet.num_serie=nom.NUM_SERIE and nom.titular=titu.TITULAR)   select jj.userdoc_SEQ,jj.userdoc_SERIES,jj.userdoc_NBR,jj.IND_SERVICE      ,jj.PERSON_NAME      ,jj.NATIONALITY_COUNTRY_CODE      ,jj.RESIDENCE_COUNTRY_CODE      ,jj.ADDRESS_STREET from (select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq,doc_ser USERDOC_SERIES,doc_nbr USERDOC_NBR      ,IND_SERVICE      ,PERSON_NAME      ,NATIONALITY_COUNTRY_CODE      ,RESIDENCE_COUNTRY_CODE      ,ADDRESS_STREET from  cte ) jj running statementcreate view dbo.vw_userdoc_owners as with cte as (SELECT pet.rowNum,cast(doc_ser as numeric)  doc_ser, doc_seq       , cast(doc_nbr as numeric)  doc_nbr     ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,'1' ind_service,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , NOMBRE PERSON_NAME ,case when (pais is null or pais='') then 'HN' else  PAIS end NATIONALITY_COUNTRY_CODE ,case when(len( LUGAR)>2 and len(pais)=2 ) then pais when len(lugar)=2 then lugar else 'HN' end RESIDENCE_COUNTRY_CODE ,case when (direccion is null or direccion='') then 'Falta direccion' else  DIRECCION end ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , CALIDAD       , qUien       , CUAL       , NRO_RESOL       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,   HN1.dbo.vw_origin_nuenoms nom ,  HN1.dbo.vw_origin_TITULAR titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and pet.num_serie=nom.NUM_SERIE and nom.titular=titu.TITULAR)   select jj.userdoc_SEQ,jj.userdoc_SERIES,jj.userdoc_NBR,jj.IND_SERVICE      ,jj.PERSON_NAME      ,jj.NATIONALITY_COUNTRY_CODE      ,jj.RESIDENCE_COUNTRY_CODE      ,jj.ADDRESS_STREET from (select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq,doc_ser USERDOC_SERIES,doc_nbr USERDOC_NBR      ,IND_SERVICE      ,PERSON_NAME      ,NATIONALITY_COUNTRY_CODE      ,RESIDENCE_COUNTRY_CODE      ,ADDRESS_STREET from  cte ) jj 
2019-04-10 17:51:44,926 - root - ERROR - >>>>>>>>>>>>>>> issue with insert query ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Argument data type date is invalid for argument 1 of isdate function. (8116) (SQLExecDirectW)')
2019-04-10 17:51:44,927 - root - INFO - wrong query:create view dbo.vw_userdoc_reprs as with cte as (SELECT pet. rowNum       , cast(doc_ser as numeric)  doc_ser    , doc_seq       , cast(doc_nbr as numeric)  doc_nbr     ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,'1' ind_service,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , titu.PERSON_NAME ,titu.NATIONALITY_COUNTRY_CODE ,titu.RESIDENCE_COUNTRY_CODE ,titu.ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,  dbo.vw_IMPORT_AGENT_PERSONS titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and AGENTE IS NOT NULL and agente!='' AND ISNUMERIC(AGENTE)=1 AND   CAST(PET.AGENTE AS NUMERIC)=titu.agent_code)  select jj.userdoc_seq,jj.userdoc_series,jj.userdoc_nbr, jj.IND_SERVICE	  ,jj.REPRESENTATIVE_TYPE      ,jj.PERSON_NAME      ,jj.NATIONALITY_COUNTRY_CODE      ,jj.RESIDENCE_COUNTRY_CODE      ,jj.ADDRESS_STREET from (select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq      ,doc_ser  USERDOC_SERIES      ,doc_nbr  USERDOC_NBR      ,IND_SERVICE	  ,'AG' REPRESENTATIVE_TYPE      ,PERSON_NAME      ,NATIONALITY_COUNTRY_CODE      ,RESIDENCE_COUNTRY_CODE      ,ADDRESS_STREET from  cte ) jj inner join dbo.vw_import_userdoc mm on   jj.USERDOC_SEQ=mm.USERDOC_SEQ and jj.USERDOC_SERIES=mm.USERDOC_SERIES and jj.userdoc_NBR = mm.userdoc_NBRrunning statementcreate view dbo.vw_userdoc_reprs as with cte as (SELECT pet. rowNum       , cast(doc_ser as numeric)  doc_ser    , doc_seq       , cast(doc_nbr as numeric)  doc_nbr     ,pet. NUM_SERIE       , 0 as ind_import , TIPO_PETI userdoc_TYPE , 1 as law_code       ,        convert(datetime, case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) FILING_DATE       ,'1' ind_service,          convert(datetime,case when isdate(solicitada)=0 then ((case when (substring(pet.num_serie,1,1) not in ('1','2','3','4','5','6','7','8','9','0')) then substring(pet.num_serie,2,4) else substring(pet.num_serie,1,4) end) + substring(solicitada,5,len(solicitada)) ) else solicitada end           + ' '+          case when (substring(hora,1,2) is null or substring(hora,1,2)='  ' or cast(substring(hora,1,2) as numeric)>23)           then '00' else substring(hora,1,2) end           + ':' + case when (substring(hora,3,2) is null or substring(hora,3,2)='  ' or cast(substring(hora,3,2) as numeric)>59) then '00' else substring(hora,3,2) end +           ':' +  case when (substring(hora,5,2) is null or substring(hora,5,2)='  ' or substring(hora,5,2)='' or cast(substring(hora,5,2) as numeric)>59) then '00' else substring(hora,5,2) end,120) RECEPTION_DATE 		,case when isnumeric(NRO_RESOL)=1 then 'Nro. resolucion: '+ NRO_RESOL else '' end +          case when len(observacio)>0 then 'observaciones: '+ cast( OBSERVACIO as varchar(max)) else '' end  notes   , titu.PERSON_NAME ,titu.NATIONALITY_COUNTRY_CODE ,titu.RESIDENCE_COUNTRY_CODE ,titu.ADDRESS_STREET ,4 capture_user_id ,getdate() capture_date       , STATUS_RES       , STAT_DESDE       , AGENTE       , OBSERVACIO       , LEY       , cambrep       ,pet. Deleted 	  ,RN = ROW_NUMBER()OVER(PARTITION BY doc_seq,doc_ser,doc_nbr ORDER BY doc_ser,doc_nbr)   FROM   dbo.vw_PETICI pet,  dbo.vw_IMPORT_AGENT_PERSONS titu     where pet.num_serie is not null and pet.num_serie !='' and len(pet.num_serie)>5   and AGENTE IS NOT NULL and agente!='' AND ISNUMERIC(AGENTE)=1 AND   CAST(PET.AGENTE AS NUMERIC)=titu.agent_code)  select jj.userdoc_seq,jj.userdoc_series,jj.userdoc_nbr, jj.IND_SERVICE	  ,jj.REPRESENTATIVE_TYPE      ,jj.PERSON_NAME      ,jj.NATIONALITY_COUNTRY_CODE      ,jj.RESIDENCE_COUNTRY_CODE      ,jj.ADDRESS_STREET from (select case when rn=1 then DOC_SEQ else doc_seq +'-'+cast(rn as varchar) end userdoc_seq      ,doc_ser  USERDOC_SERIES      ,doc_nbr  USERDOC_NBR      ,IND_SERVICE	  ,'AG' REPRESENTATIVE_TYPE      ,PERSON_NAME      ,NATIONALITY_COUNTRY_CODE      ,RESIDENCE_COUNTRY_CODE      ,ADDRESS_STREET from  cte ) jj inner join dbo.vw_import_userdoc mm on   jj.USERDOC_SEQ=mm.USERDOC_SEQ and jj.USERDOC_SERIES=mm.USERDOC_SERIES and jj.userdoc_NBR = mm.userdoc_NBR
2019-04-10 17:51:44,928 - root - ERROR - >>>>>>>>>>>>>>> issue with insert query ('42000', '[42000] [Microsoft][ODBC Driver 17 for SQL Server][SQL Server]Argument data type date is invalid for argument 1 of isdate function. (8116) (SQLExecDirectW)')
